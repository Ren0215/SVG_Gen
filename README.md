# SVGコンテキストマップ生成システム 概要

## 1. システム概要

このシステムは、企業のコンテキストマップを自動的にSVG形式で生成するパイプラインです。企業のプレスリリースから抽出したテキストデータを、6つのカテゴリに分類し、視覚的に分かりやすいコンテキストマップに変換します。LangGraphフレームワークを使用したステートマシンと、OpenAI GPT-4による文章要約機能を組み合わせた高度な自動生成システムです。

## 2. 処理の流れ

```
入力JSON（企業名・テキスト）
    ↓
パース処理（6カテゴリ分類）
    ↓
LLMによるテキスト要約
    ↓
SVG生成（Jinja2テンプレート）
    ↓
出力（SVG/PPTXファイル）
```

## 3. システム構成

### 3.1 コアコンポーネント

- **LangGraphステートマシン**: 処理フローを管理
- **OpenAI GPT-4**: テキスト要約エンジン
- **Jinja2テンプレートエンジン**: SVG生成処理
- **Pydanticモデル**: データ構造定義

### 3.2 ファイル構成

```
.
├── slide_svg_agent.py    # メインスクリプト
├── templates/
│   ├── index.json        # テンプレート情報
│   └── context_map_dark/ # テンプレートファイル
│       ├── slide.svg.j2  # SVGテンプレート
│       └── palette.json  # カラーパレット
└── data/
    └── sample_input.json # サンプル入力データ
```

## 4. 主要機能の解説

### 4.1 テキスト抽出・分類

- 正規表現を使用して6カテゴリのテキストを抽出
- 各カテゴリごとに最大5項目を選択
- URLや不要な記号を除去

### 4.2 LLMによるテキスト要約

- 長いテキストを自動的に15-20文字に要約
- カテゴリごとの文脈を考慮した最適な要約
- エラー時の自動リトライ機能

### 4.3 SVG生成

- Jinja2テンプレートによる動的SVG生成
- 楕円ノードを使用した見やすいレイアウト
- テキスト折り返しと中央配置の最適化
- ラベルの中央揃え表示

### 4.4 その他機能

- PowerPointファイル(PPTX)へのエクスポート
- コントラスト比チェック機能（アクセシビリティ）
- エラー処理とデバッグ機能

## 5. 最適化ポイント

1. **グローバル文脈表示問題の解決**
   - Pythonの予約語問題を回避する設計
   - データフローの改善

2. **テキスト表示の最適化**
   - 要約対象の文字数を20→15文字に調整
   - 改行幅を12→10文字に縮小
   - 2行までのテキスト表示に最適化

3. **レイアウト調整**
   - ラベルテキストの中央揃え
   - ノード位置の最適化
   - ノードサイズの調整（130×59ピクセル）

## 6. 実行方法

```bash
# 通常実行（LLM要約あり）
python slide_svg_agent.py --src data/sample_input.json

# LLM要約をスキップ（高速実行）
python slide_svg_agent.py --src data/sample_input.json --skip-llm

# PPTXにもエクスポート
python slide_svg_agent.py --src data/sample_input.json --export pptx
```

## 7. 今後の拡張ポイント

- 複数テンプレートのサポート
- デザインのカスタマイズオプション
- インタラクティブ要素の追加（SVG+JavaScript）
- 多言語対応

このシステムは、企業のプレスリリースからコンテキストマップを簡単に生成できる強力なツールであり、視覚的に分かりやすい形で情報を整理・表示することができます。
